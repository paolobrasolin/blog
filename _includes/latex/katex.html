<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  /* Hide and clean preamble */
  $('#preamble').addClass("hidden");
  $('#preamble').append(
    '<script type="math\/tex; mode=display ">'
        +$('#preamble').data('macros')+'<\/script>');
  /* Inline math */
  $('code').not('pre code').each(function() {
    var match = /^\$([^\$]*)\$$/.exec($(this).text());
    if(match) {
      katex.render(match[1],$(this).get(0));
      $(this).contents().unwrap();
    }
  });
  /* Display math */
  $('.language-tex').parent().parent().each(function() {
    var match = /^\$\$([^\$]*)\$\$$/m.exec($(this).text());
    if(match) {
      katex.render(match[1], $(this).get(0), {displayMode: true});
      $(this).contents().unwrap();
    }
  });
});
</script>
